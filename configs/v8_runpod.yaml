# =============================================================================
# STF-Mamba V8.0 -- RunPod A100 80GB Configuration
# =============================================================================
# Platform: RunPod (NVIDIA A100 80GB PCIe, $1.39/hr)
# Training: 50 epochs, batch_size=16
# Purpose: Stage 6 -- full paper results for CVPR/ICCV 2026
# WARNING: Do NOT use Blackwell GPUs (RTX PRO 6000, RTX 5090) -- sm_120 incompatible
# =============================================================================

# --- Model Architecture ---
model:
  backbone: "dinov2_vitb14"
  backbone_dim: 768
  freeze_blocks: 10
  finetune_blocks: 2

  temporal_proj_dim: 512
  temporal_num_blocks: 2

  hydra:
    d_state: 64
    d_conv: 7
    expand: 2
    dropout: 0.1
    use_shift: true

  consistency_head:
    input_dim: 513
    num_classes: 2

# --- Data ---
data:
  frames_per_clip: 32
  img_size: 224
  face_crop_expand: 1.3

  ff_root: "/workspace/data/faceforensics"
  celeb_df_root: "/workspace/data/celeb-df-v2"
  splits_dir: "splits"
  crop_cache_dir: "/workspace/cache/crops"
  landmark_cache_dir: "/workspace/cache/landmarks"
  sbi_cache_dir: "/workspace/cache/sbi"
  sbi_regen_interval: 30

  batch_size: 16
  num_workers: 4
  pin_memory: true

# --- Training ---
training:
  epochs: 50
  grad_clip: 1.0

  lr_backbone: 5.0e-6
  lr_temporal: 1.0e-4
  lr_head: 1.0e-4

  optimizer: "adamw"
  weight_decay: 1.0e-4

  warmup_epochs: 5
  scheduler: "cosine"

  label_smoothing: 0.0                   # NEVER > 0 (Bug #1)
  lambda_var: 0.1

  checkpoint_dir: "/workspace/checkpoints"
  save_every_n_epochs: 10
  save_best_metric: "val_auc"

  use_dataparallel: false

# --- Evaluation ---
evaluation:
  eval_ff_val: true
  eval_ff_test: true
  eval_celeb_df: true
  eval_dfdc: true

# --- Logging ---
logging:
  print_every_n_batches: 25
  log_variance_gap: true
  save_plots: true
